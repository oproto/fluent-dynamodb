# Requirements Document

## Introduction

This specification defines a comprehensive documentation overhaul for Oproto.FluentDynamoDb. The overhaul ensures documentation accuracy against the actual library implementation, establishes proper organization attribution, adds missing third-party notices, documents internal architecture, and creates standards for ongoing documentation maintenance. The library is a core component of Oproto Inc's SaaS platform for small business finance/accounting.

## Glossary

- **FluentDynamoDb**: The Oproto.FluentDynamoDb library providing fluent DynamoDB operations
- **Source Generator**: Compile-time code generation that creates type-specific methods, mappers, and builders
- **Lambda Expression API**: The preferred API style using C# lambda expressions for type-safe operations
- **Format String API**: API style using string.Format-style expressions with placeholders
- **Manual API**: Low-level API using explicit WithValue, WithKey methods
- **Entity Accessor**: Generated type-specific property on table classes for accessing entity operations
- **Extension Method Generation**: Source generator feature that creates type-specific versions of generic extension methods
- **Direct Async Methods**: Generated shorthand methods that bypass builder chains for simple operations
- **Steering File**: Kiro configuration file providing context and rules for AI-assisted development
- **Agent Hook**: Kiro automation that triggers on specific events to perform actions

## Requirements

### Requirement 1: Documentation Accuracy Audit

**User Story:** As a developer, I want documentation that accurately reflects the current library implementation, so that I can trust the examples and guidance provided.

#### Acceptance Criteria

1. WHEN comparing documentation examples to library implementation THEN the Documentation System SHALL verify all code examples compile and execute correctly against current APIs
2. WHEN a documented method or feature no longer exists THEN the Documentation System SHALL remove or update the reference to reflect current functionality
3. WHEN methods are generated by the source generator or come from extension methods THEN the Documentation System SHALL verify existence by checking all generation sources, not just single source files
4. WHEN documentation references a builder pattern THEN the Documentation System SHALL confirm the builder methods exist in the generated code, base classes, or extension methods
5. WHEN documentation shows API usage THEN the Documentation System SHALL prioritize lambda expression examples first, format string examples second, and manual API examples third

### Requirement 2: Source Code Comment Cleanup

**User Story:** As a code maintainer, I want source code comments to be relevant and professional, so that future developers see clean, contextual documentation.

#### Acceptance Criteria

1. WHEN source code contains comments referencing requirements, fixes, or issue numbers THEN the Cleanup Process SHALL remove those comments as they are not relevant to code readers
2. WHEN source code contains TODO comments referencing completed work THEN the Cleanup Process SHALL remove those comments
3. WHEN removing comments THEN the Cleanup Process SHALL preserve comments that explain complex logic, document public APIs, or provide necessary context for understanding the code
4. WHEN a comment references a spec or requirement number THEN the Cleanup Process SHALL remove the reference while preserving any useful technical explanation

### Requirement 3: Internal Architecture Documentation

**User Story:** As a contributor or advanced user, I want clear documentation of how internal interfaces connect the source generator, builders, and expression translators, so that I can understand and extend the library.

#### Acceptance Criteria

1. WHEN documenting internal architecture THEN the Documentation System SHALL explain how IDynamoDbEntity interface enables source generation
2. WHEN documenting internal architecture THEN the Documentation System SHALL explain how request builders (QueryRequestBuilder, UpdateItemRequestBuilder, etc.) integrate with generated code
3. WHEN documenting internal architecture THEN the Documentation System SHALL explain how ExpressionTranslator converts lambda expressions to DynamoDB expressions
4. WHEN documenting internal architecture THEN the Documentation System SHALL explain how extension methods are discovered and transformed into type-specific versions by the source generator
5. WHEN documenting internal architecture THEN the Documentation System SHALL include diagrams showing the relationship between entities, tables, builders, and generated code

### Requirement 4: Three API Styles Documentation

**User Story:** As a developer, I want documentation that clearly shows all three ways to perform DynamoDB operations with lambda expressions prioritized, so that I can choose the best approach for my needs.

#### Acceptance Criteria

1. WHEN documenting any DynamoDB operation THEN the Documentation System SHALL show the lambda expression approach first with clear indication it is the preferred method
2. WHEN documenting any DynamoDB operation THEN the Documentation System SHALL show the format string approach second as an alternative
3. WHEN documenting any DynamoDB operation THEN the Documentation System SHALL show the manual WithValue approach third for scenarios requiring explicit control
4. WHEN a topic specifically covers manual patterns THEN the Documentation System SHALL lead with manual examples while still referencing the preferred lambda approach
5. WHEN showing lambda expression examples THEN the Documentation System SHALL demonstrate type safety benefits and IntelliSense support

### Requirement 5: Source Generator Features Documentation

**User Story:** As a developer, I want comprehensive documentation of source generator features including extension method generation and direct async methods, so that I can leverage all generated functionality.

#### Acceptance Criteria

1. WHEN documenting source generator features THEN the Documentation System SHALL explain how extension methods are analyzed and converted to type-specific versions eliminating generic parameters
2. WHEN documenting source generator features THEN the Documentation System SHALL provide examples of generated type-specific extension methods compared to their generic counterparts
3. WHEN documenting source generator features THEN the Documentation System SHALL explain the direct async method generation that bypasses builder chains for simple queries
4. WHEN documenting source generator features THEN the Documentation System SHALL list all categories of generated code (mappers, field constants, key builders, entity accessors, extension methods, direct methods)
5. WHEN documenting source generator features THEN the Documentation System SHALL explain how to discover what code has been generated for a given entity

### Requirement 6: Organization Attribution

**User Story:** As a user of the library, I want clear attribution to Oproto Inc and relevant links, so that I can find official resources and understand the project's backing.

#### Acceptance Criteria

1. WHEN displaying project information THEN the Documentation System SHALL identify Oproto Inc as the organization behind the library
2. WHEN displaying project information THEN the Documentation System SHALL link to https://oproto.com as the main company website
3. WHEN displaying project information THEN the Documentation System SHALL link to https://oproto.io as the developer portal
4. WHEN displaying project information THEN the Documentation System SHALL link to https://fluentdynamodb.dev as the project-specific documentation site
5. WHEN displaying maintainer information THEN the Documentation System SHALL credit Dan Guisinger as primary maintainer with link to https://danguisinger.com
6. WHEN updating README or documentation landing pages THEN the Documentation System SHALL include organization and maintainer attribution in a consistent format

### Requirement 7: Third-Party Attribution for H3

**User Story:** As a user of the geospatial features, I want proper attribution for the Uber H3 implementation, so that licensing requirements are met and original authors are credited.

#### Acceptance Criteria

1. WHEN documenting third-party dependencies THEN the Documentation System SHALL add H3 attribution to THIRD-PARTY-NOTICES.md following the same format as the S2 attribution
2. WHEN adding H3 attribution THEN the Documentation System SHALL reference Uber's H3 library (https://github.com/uber/h3)
3. WHEN adding H3 attribution THEN the Documentation System SHALL include the Apache License 2.0 notice
4. WHEN adding H3 attribution THEN the Documentation System SHALL describe which algorithms and approaches are derived from H3
5. WHEN H3 code files exist THEN the Documentation System SHALL verify appropriate license headers are present in source files

### Requirement 8: API Reference Express List

**User Story:** As a developer, I want a quick reference list of all major API and builder methods, so that I can quickly find available operations without searching through documentation.

#### Acceptance Criteria

1. WHEN creating API reference THEN the Documentation System SHALL list all request builder classes with their primary methods
2. WHEN creating API reference THEN the Documentation System SHALL list all generated entity accessor methods
3. WHEN creating API reference THEN the Documentation System SHALL list all direct async shorthand methods
4. WHEN creating API reference THEN the Documentation System SHALL organize methods by operation category (Query, Get, Put, Update, Delete, Batch, Transaction)
5. WHEN creating API reference THEN the Documentation System SHALL indicate which methods are generated vs manually defined
6. WHEN creating API reference THEN the Documentation System SHALL provide brief descriptions and link to detailed documentation

### Requirement 9: Documentation Standards Steering File

**User Story:** As a contributor using AI assistance, I want a steering file that defines documentation standards, so that all documentation follows consistent patterns.

#### Acceptance Criteria

1. WHEN creating steering file THEN the Documentation System SHALL define the three API styles and their priority order (lambda first, format string second, manual third)
2. WHEN creating steering file THEN the Documentation System SHALL define rules for verifying method existence across all sources (generated code, base classes, extension methods)
3. WHEN creating steering file THEN the Documentation System SHALL define organization attribution requirements
4. WHEN creating steering file THEN the Documentation System SHALL define code example formatting standards
5. WHEN creating steering file THEN the Documentation System SHALL define rules for when to update documentation (new features, API changes, deprecations)

### Requirement 10: Agent Hook Consideration

**User Story:** As a maintainer, I want to consider automation for documentation updates, so that documentation stays current with code changes.

#### Acceptance Criteria

1. WHEN evaluating agent hooks THEN the Documentation System SHALL assess whether automatic documentation updates are beneficial given the frequency of relevant changes
2. WHEN evaluating agent hooks THEN the Documentation System SHALL document the decision and rationale in the steering file
3. IF agent hooks are deemed beneficial THEN the Documentation System SHALL define specific triggers (e.g., changes to public API files, new attributes, builder modifications)
4. IF agent hooks are not implemented THEN the Documentation System SHALL document manual review checkpoints for documentation accuracy
