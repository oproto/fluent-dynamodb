# Requirements Document

## Introduction

This document specifies the requirements for refactoring the scannable table functionality in Oproto.FluentDynamoDb. The current implementation uses a wrapper pattern with `AsScannable()` extension method, `IScannableDynamoDbTable` interface, and `ScannableDynamoDbTable` wrapper class. The new approach will use a `[Scannable]` attribute with source generation to add `Scan()` methods directly to table classes, aligning with the library's existing patterns for other operations like `Query()`, `Get()`, `Update()`, and `Delete()`.

## Glossary

- **Table Class**: A partial class that inherits from `DynamoDbTableBase` and is annotated with `[DynamoDbTable]` attribute
- **Source Generator**: The incremental source generator that analyzes table classes and generates additional methods and properties
- **Scan Operation**: A DynamoDB operation that examines every item in a table or index, which is expensive and should be used sparingly
- **ScanRequestBuilder**: The fluent builder class for constructing DynamoDB scan requests
- **Scannable Attribute**: The new `[Scannable]` attribute that marks a table class as supporting scan operations
- **Generated Scan Methods**: The `Scan()` and `Scan(string, params object[])` methods that will be generated by the source generator

## Requirements

### Requirement 1: Attribute-Based Opt-In

**User Story:** As a developer, I want to opt-in to scan operations using a `[Scannable]` attribute on my table class, so that the API is consistent with other library patterns.

#### Acceptance Criteria

1. WHEN a developer applies the `[Scannable]` attribute to a table class, THE Source Generator SHALL generate `Scan()` methods for that table
2. WHEN a developer does not apply the `[Scannable]` attribute to a table class, THE Source Generator SHALL NOT generate `Scan()` methods for that table
3. THE Scannable Attribute SHALL be defined in the `Oproto.FluentDynamoDb.Attributes` project
4. THE Scannable Attribute SHALL have an `AttributeTargets.Class` target
5. THE Scannable Attribute SHALL allow only single usage per class

### Requirement 2: Generated Scan Method Overloads

**User Story:** As a developer, I want both parameterless and expression-based `Scan()` methods generated on my table class, so that I have flexible ways to initiate scan operations.

#### Acceptance Criteria

1. WHEN the `[Scannable]` attribute is present, THE Source Generator SHALL generate a parameterless `Scan()` method that returns a `ScanRequestBuilder`
2. WHEN the `[Scannable]` attribute is present, THE Source Generator SHALL generate a `Scan(string filterExpression, params object[] values)` method that returns a `ScanRequestBuilder`
3. THE parameterless `Scan()` method SHALL create a new `ScanRequestBuilder` configured with the table name
4. THE expression-based `Scan()` method SHALL create a new `ScanRequestBuilder` configured with the table name and filter expression
5. THE generated methods SHALL use the same pattern as existing `Query()` methods for consistency

### Requirement 3: Source Generator Integration

**User Story:** As a developer, I want the source generator to detect the `[Scannable]` attribute and generate appropriate code, so that scan functionality is automatically available without manual implementation.

#### Acceptance Criteria

1. WHEN the Source Generator analyzes a table class, THE Source Generator SHALL check for the presence of the `[Scannable]` attribute
2. WHEN the `[Scannable]` attribute is detected, THE Source Generator SHALL include scan method generation in the table class output
3. THE Source Generator SHALL generate scan methods in the same partial class file as other generated table methods
4. THE Source Generator SHALL include appropriate XML documentation comments for generated scan methods
5. THE generated code SHALL include warning comments about scan operation costs

### Requirement 4: Manual Implementation Support

**User Story:** As a developer not using source generation, I want to manually implement `Scan()` methods on my table class, so that I can still use scan operations without code generation.

#### Acceptance Criteria

1. WHEN a developer manually implements a `Scan()` method on a table class, THE manually implemented method SHALL be usable without conflicts
2. THE `ScanRequestBuilder` constructor SHALL accept an `IAmazonDynamoDB` client and table name
3. THE manual implementation pattern SHALL be documented in code examples
4. THE manual implementation SHALL follow the same signature as generated methods

### Requirement 5: Legacy Code Removal

**User Story:** As a maintainer, I want to remove the wrapper-based scannable implementation, so that the codebase is simpler and more consistent.

#### Acceptance Criteria

1. THE `IScannableDynamoDbTable` interface SHALL be removed from the codebase
2. THE `ScannableDynamoDbTable` wrapper class SHALL be removed from the codebase
3. THE `AsScannable()` extension method SHALL be removed from `DynamoDbTableBase`
4. THE `ScanRequestBuilder` class SHALL remain unchanged and functional
5. THE `ScanResponse` class SHALL remain unchanged and functional

### Requirement 6: Documentation and Examples

**User Story:** As a developer, I want clear documentation on how to use the new `[Scannable]` attribute, so that I understand when and how to enable scan operations.

#### Acceptance Criteria

1. THE `[Scannable]` attribute SHALL include XML documentation explaining its purpose
2. THE XML documentation SHALL include warnings about scan operation costs
3. THE XML documentation SHALL include code examples showing usage
4. THE generated `Scan()` methods SHALL include XML documentation with usage examples
5. THE documentation SHALL explain when scan operations are appropriate to use
